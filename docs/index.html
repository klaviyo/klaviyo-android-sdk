<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>All modules</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
<link href="styles/style.css" rel="Stylesheet">
<link href="styles/jetbrains-mono.css" rel="Stylesheet">
<link href="styles/main.css" rel="Stylesheet">
<link href="styles/prism.css" rel="Stylesheet">
<link href="styles/logo-styles.css" rel="Stylesheet">
<script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="scripts/prism.js" async="async"></script>
<script type="text/javascript" src="scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
</head>
<body>
<div class="navigation-wrapper" id="navigation-wrapper">
    <div id="leftToggler"><span class="icon-toggler"></span></div>
    <div class="library-name">
            <a href="index.html">
                    <span>klaviyo-android-sdk</span>
            </a>
    </div>
    <div>
    </div>
    <div class="pull-right d-flex">
        <button id="theme-toggle-button"><span id="theme-toggle"></span></button>
        <div id="searchBar"></div>
    </div>
</div>
<div id="container">
    <div id="leftColumn">
        <div id="sideMenu"></div>
    </div>
    <div id="main">
<div class="main-content" id="content" pageIds="klaviyo-android-sdk::.ext/allModules///PointingToDeclaration//0">
  <div class="breadcrumbs"></div>
  <div class="cover ">
    <div class="cover ">
      <h1 class="">klaviyo-android-sdk</h1>
      <h2 class=""> DISCLAIMER</h2>
      <p class="paragraph"><i>This project is still in pre-alpha, breaking changes are still being made to the API.  This is not yet intended for public use</i></p>
      <p class="paragraph">Android SDK allows developers to incorporate Klaviyo event and profile tracking functionality within native Android applications. The SDK assists in identifying users and tracking user events. Once integrated, your marketing team will be able to better understand your app users' needs and send them timely push notifications via FCM.</p>
      <h2 class=""> Installation</h2>
      <h2 class=""> Core SDK</h2>
      <h3 class=""> Configuration</h3>
      <p class="paragraph">The SDK must be configured with the public API key for your Klaviyo account. We require access to the <code class="lang-kotlin">applicationContext</code> so the SDK can be responsive to  changes in network conditions and persist data with <code class="lang-kotlin">SharedPreferences</code>. You must also register the Klaviyo SDK for activity lifecycle callbacks per the example code:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">import android.app.Application<br>import com.klaviyo.analytics.Klaviyo<br>import com.klaviyo.analytics.lifecycle.KlaviyoLifecycleMonitor<br>import com.klaviyo.push.KlaviyoPushService<br><br>class TestApp : Application() {<br>    override fun onCreate() {<br>        super.onCreate()<br><br>        Klaviyo.initialize(&quot;KLAVIYO_PUBLIC_API_KEY&quot;, applicationContext)<br><br>        registerActivityLifecycleCallbacks(Klaviyo.lifecycleCallbacks)<br>    }<br>}</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h3 class=""> Identifying a Profile</h3>
      <p class="paragraph">The SDK provides helpers for identifying profiles and syncing via the  <a href="https://developers.klaviyo.com/en/reference/create_client_profile">Klaviyo client API</a>. All profile identifiers (email, phone, external ID, anonymous ID) are persisted to local storage so that the SDK can keep track of the current profile.</p>
      <p class="paragraph">Klaviyo SDK does not validate email address or phone number inputs locally, see <a href="https://help.klaviyo.com/hc/en-us/articles/360046055671-Accepted-phone-number-formats-for-SMS-in-Klaviyo">documentation</a> on proper phone number formatting</p>
      <p class="paragraph">Profile attributes can be set all at once: </p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">val profile = Profile(mapOf(<br>    ProfileKey.EMAIL to &quot;kermit@example.com&quot;,<br>    ProfileKey.FIRST_NAME to &quot;Kermit&quot;<br>))<br>Klaviyo.setProfile(profile)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">or individually with fluent setters:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">Klaviyo.setEmail(&quot;kermit@example.com&quot;)<br>    .setPhoneNumber(&quot;+12223334444&quot;)<br>    .setExternalId(&quot;USER_IDENTIFIER&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Kermit&quot;)<br>    .setProfileAttribute(ProfileKey.CUSTOM(&quot;instrument&quot;), &quot;banjo&quot;)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">Either way, the SDK will group and batch API calls to limit resource usage.</p>
      <p class="paragraph"><strong>All the fluent setter methods are additive</strong>. To start a <i>new</i> profile altogether (e.g. if a user logs out) either call <code class="lang-kotlin">Klaviyo.resetProfile()</code>  to clear the currently tracked profile identifiers (e.g. on logout), or use <code class="lang-kotlin">Klaviyo.setProfile(profile)</code> to overwrite it with a new profile object. </p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">//Start a profile for Kermit<br>Klaviyo.setEmail(&quot;kermit@example.com&quot;)<br>    .setPhoneNumber(&quot;+12223334444&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Kermit&quot;)<br><br>//Stop tracking Kermit<br>Klaviyo.resetProfile()<br><br>//Start new profile for Robin with new IDs<br>Klaviyo.setEmail(&quot;robin@example.com&quot;)<br>    .setPhoneNumber(&quot;+5556667777&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Robin&quot;)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h3 class=""> Tracking Events</h3>
      <p class="paragraph">The SDK also provides tools for tracking analytics events to the Klaviyo API. A list of previously defined event names is provided in <code class="lang-kotlin">EventType</code>, or use <code class="lang-kotlin">EventType.CUSTOM(&quot;name&quot;)</code> to for custom name. Additional event properties can be specified as part of <code class="lang-kotlin">EventModel</code> </p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">val event = Event(EventType.VIEWED_PRODUCT)<br>    .setProperty(EventKey.VALUE, &quot;10&quot;)<br>    .setProperty(EventKey.CUSTOM(&quot;custom_key&quot;), &quot;value&quot;)<br>Klaviyo.createEvent(event)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h2 class=""> Push Notifications</h2>
      <h3 class=""> Prerequisites: </h3>
      <ul>
        <li>
          <p class="paragraph">Firebase account</p>
        </li>
        <li>
          <p class="paragraph">Familiarity with <a href="https://firebase.google.com/docs/cloud-messaging/android/client">Firebase</a> documentation. </p>
        </li>
      </ul>
      <h3 class=""> KlaviyoPushService</h3>
      <p class="paragraph">The Klaviyo Push SDK for Android works as a wrapper around <code class="lang-kotlin">FirebaseMessagingService</code> so the  setup process is very similar to the Firebase client documentation linked above. You should follow all other setup recommendations from the FCM documentation. Register <code class="lang-kotlin">KlaviyoPushService</code> to receive MESSAGING_EVENT intents. This allows Klaviyo Push SDK  to receive new and updated push tokens via the <code class="lang-kotlin">onNewToken</code> method,  as well as foreground and data notifications via the <code class="lang-kotlin">onMessageReceived</code> method.</p>
      <div class="sample-container">
        <pre><code class="block lang-xml" theme="idea">&lt;service android:name=&quot;com.klaviyo.pushFcm.KlaviyoPushService&quot; android:exported=&quot;false&quot;&gt;<br>    &lt;intent-filter&gt;<br>        &lt;action android:name=&quot;com.google.firebase.MESSAGING_EVENT&quot; /&gt;<br>    &lt;/intent-filter&gt;<br>&lt;/service&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">Additionally, update your launcher activity to retrieve the <i>current</i> device token on startup and register it with Klaviyo SDK. To track notifications opened from the system tray  (i.e. received while the app is backgrounded) pass the <code class="lang-kotlin">Intent</code> to KlaviyoPushService.</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">    override fun onCreate(savedInstanceState: Bundle?) {<br>        super.onCreate(savedInstanceState)<br>    <br>        //Fetches the current push token and registers with Push SDK<br>        FirebaseMessaging.getInstance().token.addOnSuccessListener {<br>            Klaviyo.setPushToken(it)<br>        }<br><br>        onNewIntent(intent)<br>    }<br><br>    override fun onNewIntent(intent: Intent?) {<br>        super.onNewIntent(intent)<br><br>        //Tracks when a system tray notification is opened<br>        Klaviyo.handlePush(intent)<br>    }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h3 class=""> Manual implementation of <code class="lang-kotlin">FirebaseMessagingService</code> (Advanced)</h3>
      <p class="paragraph">If you'd prefer to implement <code class="lang-kotlin">FirebaseMessagingService</code> yourself, follow the FCM  setup docs including referencing your own service class in the manifest. Then update your implementation of <code class="lang-kotlin">onNewToken</code> and <code class="lang-kotlin">onMessageReceived</code> as below to communicate  push tokens and notifications received to the Klaviyo SDK. The launcher activity  code snippets above are still required.</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">import com.google.firebase.messaging.RemoteMessage<br>import com.klaviyo.push.KlaviyoPushService<br><br>class YourPushService: FirebaseMessagingService() {<br>    override fun onNewToken(newToken: String) {<br>        super.onNewToken(newToken)<br>        Klaviyo.setPushToken(newToken)<br>    }<br><br>    override fun onMessageReceived(message: RemoteMessage) {<br>        super.onMessageReceived(message)<br>        //You should decide how you want to handle messages receive in foreground<br>    }<br>}</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph"><strong>A note on push tokens and multiple profiles:</strong> Klaviyo SDK will disassociate the device push token from the current profile whenever it is reset by calling <code class="lang-kotlin">setProfile</code> or <code class="lang-kotlin">resetProfile</code>.  You should call <code class="lang-kotlin">setPushToken</code> again after resetting the currently tracked profile  to explicitly to associate the device token to the new profile.</p>
      <h2 class=""> Code Documentation</h2>
      <p class="paragraph">Browse complete code documentation autogenerated with dokka <a href="https://klaviyo.github.io/klaviyo-android-sdk/">here</a></p>
    </div>
    <h2 class="">All modules:</h2>
    <div class="table"><a data-name="-242632249%2FMain%2F0" anchor-label="analytics" id="-242632249%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/analytics/index.html">analytics</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-242632249%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="-387464810%2FMain%2F0" anchor-label="core" id="-387464810%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/core/index.html">core</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-387464810%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="1811326475%2FMain%2F0" anchor-label="fixtures" id="1811326475%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/fixtures/index.html">fixtures</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1811326475%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="-503032104%2FMain%2F0" anchor-label="push-fcm" id="-503032104%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/push-fcm/index.html">push-fcm</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-503032104%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2023 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
    </div>
</div>
</body>
</html>
