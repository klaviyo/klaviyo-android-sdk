<!DOCTYPE html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>All modules</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
<link href="styles/style.css" rel="Stylesheet">
<link href="styles/main.css" rel="Stylesheet">
<link href="styles/prism.css" rel="Stylesheet">
<link href="styles/logo-styles.css" rel="Stylesheet">
<link href="styles/font-jb-sans-auto.css" rel="Stylesheet">
<script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="scripts/prism.js" async="async"></script>
<script type="text/javascript" src="scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
<link href="styles/multimodule.css" rel="Stylesheet">
</head>
<body>
    <div class="root">
<nav class="navigation" id="navigation-wrapper">
    <div class="navigation--inner">
        <div class="navigation-title">
            <button class="menu-toggle" id="menu-toggle" type="button">toggle menu</button>
            <div class="library-name">
                    <a class="library-name--link" href="index.html">
                            klaviyo-android-sdk
                    </a>
            </div>
            <div class="library-version">
<dokka-template-command data="{&quot;@class&quot;:&quot;org.jetbrains.dokka.base.templating.ReplaceVersionsCommand&quot;,&quot;location&quot;:&quot;index.html&quot;}">3.3.0</dokka-template-command>            </div>
        </div>
    </div>
    <div class="navigation-controls">
        <button class="navigation-controls--btn navigation-controls--theme" id="theme-toggle-button" type="button">switch theme</button>
        <div class="navigation-controls--btn navigation-controls--search" id="searchBar" role="button">search in API</div>
    </div>
</nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="sidebar--inner" id="sideMenu"></div>
            </div>
            <div id="main">
<div class="main-content" id="content" pageIds="klaviyo-android-sdk::.ext/allModules///PointingToDeclaration//0">
  <div class="breadcrumbs"></div>
  <div class="cover ">
    <div class="cover ">
      <h1 class="">klaviyo-android-sdk</h1>
      <p class="paragraph"><a href="https://github.com/klaviyo/klaviyo-android-sdk/blob/master/LICENSE.md"></a> <a href="https://jitpack.io/#klaviyo/klaviyo-android-sdk"><img alt="Latest" src="https://jitpack.io/v/klaviyo/klaviyo-android-sdk.svg"></a> <a href="https://github.com/klaviyo/klaviyo-android-sdk/releases"></a> <a href="https://github.com/klaviyo/klaviyo-android-sdk/actions/workflows/android-master.yml"></a></p>
      <p class="paragraph">The Klaviyo Android SDK allows developers to incorporate Klaviyo analytics and push notification functionality in their native Android applications. The SDK assists in identifying users and tracking user events via the  latest <a href="https://developers.klaviyo.com/en/reference/api_overview">Klaviyo Client APIs</a>. To reduce performance overhead, API requests are queued and sent in batches.  The queue is persisted to local storage so that data is not lost if the device is offline or the app is terminated.</p>
      <p class="paragraph">Once integrated, your marketing team will be able to better understand your app users' needs and send them timely push notifications via <a href="https://firebase.google.com/docs/cloud-messaging">FCM (Firebase Cloud Messaging)</a>.</p>
      <h2 class=""> Requirements</h2>
      <ul>
        <li>
          <p class="paragraph">Kotlin <strong>1.8.0</strong> or later</p>
        </li>
        <li>
          <p class="paragraph">Android API level <strong>23</strong> or later</p>
        </li>
      </ul>
      <h2 class=""> Installation</h2>
      <ol>
        <li>
          <p class="paragraph">Include the <a href="https://jitpack.io/#klaviyo/klaviyo-android-sdk">JitPack</a> repository in your project's build file</p>
<details>
      <summary>Kotlin DSL</summary>          <div class="sample-container">
            <pre><code class="block lang-kotlin" theme="idea">   // settings.gradle.kts<br>   dependencyResolutionManagement {<br>       repositories {<br>           maven(url = &quot;https://jitpack.io&quot;)<br>       }<br>   }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
</details><details open>
      <summary>Groovy</summary>          <div class="sample-container">
            <pre><code class="block lang-groovy" theme="idea">   // settings.gradle<br>   dependencyResolutionManagement {<br>       repositories {<br>           maven { url &quot;https://jitpack.io&quot; }<br>       }<br>   }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
</details>        </li>
        <li>
          <p class="paragraph">Add the dependencies to your app's build file</p>
<details>
      <summary>Kotlin DSL</summary>          <div class="sample-container">
            <pre><code class="block lang-kotlin" theme="idea">   // build.gradle.kts<br>   dependencies {<br>       implementation(&quot;com.github.klaviyo.klaviyo-android-sdk:analytics:3.3.0&quot;)<br>       implementation(&quot;com.github.klaviyo.klaviyo-android-sdk:push-fcm:3.3.0&quot;)<br>       implementation(&quot;com.github.klaviyo.klaviyo-android-sdk:forms:3.3.0&quot;)<br>   }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
</details><details open>
      <summary>Groovy</summary>          <div class="sample-container">
            <pre><code class="block lang-groovy" theme="idea">    // build.gradle<br>    dependencies {<br>        implementation &quot;com.github.klaviyo.klaviyo-android-sdk:analytics:3.3.0&quot;<br>        implementation &quot;com.github.klaviyo.klaviyo-android-sdk:push-fcm:3.3.0&quot;<br>        implementation &quot;com.github.klaviyo.klaviyo-android-sdk:forms:3.3.0&quot;<br>    }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
</details>        </li>
      </ol>
      <h2 class=""> Initialization</h2>
      <p class="paragraph">The SDK must be initialized with the short alphanumeric <a href="https://help.klaviyo.com/hc/en-us/articles/115005062267#difference-between-public-and-private-api-keys1">public API key</a> for your Klaviyo account, also known as your Site ID. We require access to the <code class="lang-kotlin">applicationContext</code> so the SDK can be responsive to changes in application state and network conditions, and access <code class="lang-kotlin">SharedPreferences</code> to persist data. Upon initialize, the SDK registers listeners for your application's activity lifecycle callbacks, to gracefully manage background processes.</p>
      <p class="paragraph"><code class="lang-kotlin">Klaviyo.initialize()</code> <strong>must</strong> be called before any other SDK methods can be invoked. We recommend initializing from  the earliest point in your application code, the <code class="lang-kotlin">Application.onCreate()</code> method.</p>
      <p class="paragraph"><strong>Note:</strong> If you are unable to <code class="lang-kotlin">Application.onCreate()</code> (e.g. if your API key is dynamic and not yet available) you <strong>must</strong> call <code class="lang-kotlin">Klaviyo.registerForLifecycleCallbacks(applicationContext)</code> and provide your API key via <code class="lang-kotlin">initialize</code> as early as it is available.</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">// Application subclass <br>import android.app.Application<br>import com.klaviyo.analytics.Klaviyo<br><br>class YourApplication : Application() {<br>    override fun onCreate() {<br>        super.onCreate()<br><br>        /* ... */<br>        <br>        // Initialize is required before invoking any other Klaviyo SDK functionality <br>        Klaviyo.initialize(&quot;KLAVIYO_PUBLIC_API_KEY&quot;, applicationContext)<br>        <br>        // If unable to call initialize, you must at least register lifecycle listeners:<br>        Klaviyo.registerForLifecycleCallbacks(applicationContext)<br>    }<br>}</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h2 class=""> Profile Identification</h2>
      <p class="paragraph">The SDK provides methods to identify profiles via the <a href="https://developers.klaviyo.com/en/reference/create_client_profile">Create Client Profile API</a>. A profile can be identified by any combination of the following:</p>
      <ul>
        <li>
          <p class="paragraph">External ID: A unique identifier used by customers to associate Klaviyo profiles with profiles in an external system,   such as a point-of-sale system. Format varies based on the external system.</p>
        </li>
        <li>
          <p class="paragraph">Individual's email address</p>
        </li>
        <li>
          <p class="paragraph">Individual's phone number in <a href="https://help.klaviyo.com/hc/en-us/articles/360046055671#h_01HE5ZYJEAHZKY6WZW7BAD36BG">E.164 format</a></p>
        </li>
      </ul>
      <p class="paragraph">Identifiers are persisted to local storage so that the SDK can keep track of the current profile.</p>
      <p class="paragraph">Profile identifiers and other attributes can be set all at once using the <code class="lang-kotlin">Profile</code> data class:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">val profile = Profile(<br>    externalId = &quot;USER_IDENTIFIER&quot;,<br>    email = &quot;kermit@example.com&quot;,<br>    phoneNumber = &quot;+12223334444&quot;,<br>    properties = mapOf(<br>        ProfileKey.FIRST_NAME to &quot;Kermit&quot;,<br>        ProfileKey.CUSTOM(&quot;instrument&quot;) to &quot;banjo&quot;<br>    )<br>)<br><br>Klaviyo.setProfile(profile)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">Or individually with additive fluent setters:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">Klaviyo.setExternalId(&quot;USER_IDENTIFIER&quot;)<br>    .setEmail(&quot;kermit@example.com&quot;)<br>    .setPhoneNumber(&quot;+12223334444&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Kermit&quot;)<br>    .setProfileAttribute(ProfileKey.CUSTOM(&quot;instrument&quot;), &quot;banjo&quot;)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">Either way, the SDK will group and batch API calls to improve performance.</p>
      <h3 class=""> Reset Profile</h3>
      <p class="paragraph">To start a <i>new</i> profile altogether (e.g. if a user logs out) either call <code class="lang-kotlin">Klaviyo.resetProfile()</code> to clear the currently tracked profile identifiers (e.g. on logout), or use <code class="lang-kotlin">Klaviyo.setProfile(profile)</code> to overwrite it with a new profile object.</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">// Start a profile for Kermit<br>Klaviyo.setEmail(&quot;kermit@example.com&quot;)<br>    .setPhoneNumber(&quot;+12223334444&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Kermit&quot;)<br><br>// Stop tracking Kermit<br>Klaviyo.resetProfile()<br><br>// Start a new profile for Robin<br>Klaviyo.setEmail(&quot;robin@example.com&quot;)<br>    .setPhoneNumber(&quot;+5556667777&quot;)<br>    .setProfileAttribute(ProfileKey.FIRST_NAME, &quot;Robin&quot;)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph"><strong>Note:</strong> We trim leading and trailing whitespace off of identifier values.  Empty strings will be ignored with a logged warning. If you are trying to remove an identifier's value, use <code class="lang-kotlin">setProfile</code> or <code class="lang-kotlin">resetProfile</code>.</p>
      <h3 class=""> Anonymous Tracking</h3>
      <p class="paragraph">Klaviyo will track unidentified users with an autogenerated ID whenever a push token is set or an event is created. That way, you can collect push tokens and track events prior to collecting profile identifiers such as email or phone number. When an identifier is provided, Klaviyo will merge the anonymous user with an identified user.</p>
      <h2 class=""> Event Tracking</h2>
      <p class="paragraph">The SDK also provides tools for tracking analytics events via the <a href="https://developers.klaviyo.com/en/reference/create_client_event">Create Client Event API</a>. A list of common Klaviyo-defined event metrics is provided in <code class="lang-kotlin">EventMetric</code>, or you can use <code class="lang-kotlin">EventMetric.CUSTOM(&quot;name&quot;)</code> for custom event metric names. Additional event properties can be specified as part of <code class="lang-kotlin">EventModel</code></p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">val event = Event(EventMetric.VIEWED_PRODUCT)<br>    .setProperty(EventKey.CUSTOM(&quot;Product&quot;), &quot;Coffee Mug&quot;)<br>    .setValue(10.0)<br>Klaviyo.createEvent(event)</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h2 class=""> Push Notifications</h2>
      <h3 class=""> Prerequisites</h3>
      <ul>
        <li>
          <p class="paragraph">A <a href="https://firebase.google.com/docs/android/setup">Firebase account</a> for your Android app</p>
        </li>
        <li>
          <p class="paragraph">Familiarity with <a href="https://firebase.google.com/docs/cloud-messaging/android/client">Firebase</a> documentation</p>
        </li>
        <li>
          <p class="paragraph">Configure <a href="https://help.klaviyo.com/hc/en-us/articles/14750928993307">Android push</a> in your Klaviyo account settings</p>
        </li>
        <li>
          <p class="paragraph">Klaviyo <code class="lang-kotlin">analytics</code> and <code class="lang-kotlin">push-fcm</code> packages</p>
        </li>
        <li>
          <p class="paragraph">If you expect to use deep links in your push notifications, see the #deep-linking section below.</p>
        </li>
      </ul>
      <h3 class=""> Setup</h3>
      <p class="paragraph">The Klaviyo Push SDK for Android works as a wrapper around <code class="lang-kotlin">FirebaseMessagingService</code>, so the setup process is very similar to the Firebase client documentation linked above.<br>In your <code class="lang-kotlin">AndroidManifest.xml</code> file, register <code class="lang-kotlin">KlaviyoPushService</code> to receive <code class="lang-kotlin">MESSAGING_EVENT</code> intents.</p>
      <div class="sample-container">
        <pre><code class="block lang-xml" theme="idea">&lt;!-- AndroidManifest.xml --&gt;<br>&lt;manifest&gt;<br>    &lt;!-- ... --&gt;<br>    &lt;application&gt;<br>        &lt;!-- ... --&gt;<br>        &lt;service android:name=&quot;com.klaviyo.pushFcm.KlaviyoPushService&quot; android:exported=&quot;false&quot;&gt;<br>            &lt;intent-filter&gt;<br>                &lt;action android:name=&quot;com.google.firebase.MESSAGING_EVENT&quot; /&gt;<br>            &lt;/intent-filter&gt;<br>        &lt;/service&gt;<br>    &lt;/application&gt;<br>&lt;/manifest&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">To specify an icon and/or color for Klaviyo notifications, add the following optional metadata elements to the application component of <code class="lang-kotlin">AndroidManifest.xml</code>. Absent these keys, the firebase keys <code class="lang-kotlin">com.google.firebase.messaging.default_notification_icon</code> and <code class="lang-kotlin">com.google.firebase.messaging.default_notification_color</code>  will be used if present, else we fall back on the application's launcher icon, and omit setting a color.   </p>
      <div class="sample-container">
        <pre><code class="block lang-xml" theme="idea">&lt;!-- AndroidManifest.xml --&gt;<br>&lt;manifest&gt;<br>    &lt;!-- ... --&gt;<br>    &lt;application&gt;<br>        &lt;!-- ... --&gt;<br>        &lt;meta-data android:name=&quot;com.klaviyo.push.default_notification_icon&quot;<br>            android:resource=&quot;{YOUR_ICON_RESOURCE}&quot; /&gt;<br>        &lt;meta-data android:name=&quot;com.klaviyo.push.default_notification_color&quot;<br>            android:resource=&quot;{YOUR_COLOR}&quot; /&gt;<br>    &lt;/application&gt;<br>&lt;/manifest&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h3 class=""> Collecting Push Tokens</h3>
      <p class="paragraph">In order to send push notifications to your users, you must collect their push tokens and register them with Klaviyo. This is done via the <code class="lang-kotlin">Klaviyo.setPushToken</code> method, which registers push token and current authorization state via the <a href="https://developers.klaviyo.com/en/reference/create_client_push_token">Create Client Push Token API</a>. Once registered in your manifest, <code class="lang-kotlin">KlaviyoPushService</code> will receive <i>new</i> push tokens via the <code class="lang-kotlin">onNewToken</code> method. We also recommend retrieving the latest token value on app startup and registering it with Klaviyo SDK. Add the following to your <code class="lang-kotlin">Application.onCreate</code> method. </p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">override fun onCreate(savedInstanceState: Bundle?) {<br>    /* ... */<br><br>    // Fetches the current push token and registers with Push SDK<br>    FirebaseMessaging.getInstance().token.addOnSuccessListener { pushToken -&gt;<br>        Klaviyo.setPushToken(pushToken)<br>    }<br>}</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph"><i>As of version 3.0.0</i>: After setting a push token, the Klaviyo SDK will automatically track changes to the user's notification permission whenever the application is opened or resumed from the background.</p>
      <p class="paragraph"><strong>Reminder</strong>: <code class="lang-kotlin">Klaviyo.initialize</code> is required before using any other Klaviyo SDK functionality, even  if you are only using the SDK for push notifications and not analytics.</p>
      <blockquote class="quotation">
        <p class="paragraph">Android 13 introduced a new <a href="https://developer.android.com/develop/ui/views/notifications/notification-permission">runtime permission</a>  for displaying notifications. The Klaviyo SDK automatically adds the  <a href="https://developer.android.com/reference/android/Manifest.permission#POST_NOTIFICATIONS"><code class="lang-kotlin">POST_NOTIFICATIONS</code></a>  permission to the manifest, but you will need to request user permission according to   <a href="https://source.android.com/docs/core/display/notification-perm">Android best practices</a>  and the best user experience in the context of your application. The linked resources  provide code examples for requesting permission and handling the user's response.</p>
      </blockquote>
      <h4 class=""> Push tokens and multiple profiles</h4>
      <p class="paragraph">If a new profile was set using <code class="lang-kotlin">setProfile</code> or if <code class="lang-kotlin">resetProfile</code> was called and a new anonymous  profile was created, the push token will be automatically associated with the new profile without  any additional action (like setting token again) required. This functionality was added in release <code class="lang-kotlin">3.0.0</code>. </p>
      <h3 class=""> Receiving Push Notifications</h3>
      <p class="paragraph"><code class="lang-kotlin">KlaviyoPushService</code> will handle displaying all notifications via the <code class="lang-kotlin">onMessageReceived</code> method regardless of whether the app is in the foreground or background. You can send test notifications to a specific token using the <a href="https://help.klaviyo.com/hc/en-us/articles/18011985278875">push notification preview</a> feature in order to test your integration. If you wish to customize how notifications are displayed, see #advanced-setup.</p>
      <h4 class=""> Rich Push</h4>
      <p class="paragraph"><a href="https://help.klaviyo.com/hc/en-us/articles/16917302437275">Rich Push</a> is the ability to add images to  push notification messages. This feature is supported in version 1.3.1 and up of the Klaviyo Android SDK. No additional setup is needed to support rich push. Downloading the image and attaching it to the notification is handled within <code class="lang-kotlin">KlaviyoPushService</code>. If an image fails to download (e.g. if the device has a poor network  connection) the notification will be displayed without an image after the download times out.</p>
      <h4 class=""> Tracking Open Events</h4>
      <p class="paragraph">To track push notification opens, you must call <code class="lang-kotlin">Klaviyo.handlePush(intent)</code> when your app is launched from an intent. This method will check if the app was opened from a notification originating from Klaviyo and if so, create an  <code class="lang-kotlin">Opened Push</code> event with required message tracking parameters. For example:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">// Main Activity<br><br>override fun onCreate(savedInstanceState: Bundle?) {<br>    /* ... */<br><br>    onNewIntent(intent)<br>}<br><br>override fun onNewIntent(intent: Intent?) {<br>    /* ... */<br><br>    // Tracks when a system tray notification is opened<br>    Klaviyo.handlePush(intent)<br>}</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph"><strong>Note:</strong> Intent handling may differ depending on your app's architecture. By default, the Klaviyo SDK will use your app's launch intent for a tapped notification. Adjust this example to your use-case, ensuring that  <code class="lang-kotlin">Klaviyo.handlePush(intent)</code> is called whenever your app is opened from a notification.</p>
      <h3 class=""> Advanced Setup</h3>
      <p class="paragraph">If you'd prefer to have your own implementation of <code class="lang-kotlin">FirebaseMessagingService</code>, follow the FCM setup docs including referencing your own service class in the manifest.</p>
      <div class="sample-container">
        <pre><code class="block lang-xml" theme="idea">&lt;!-- AndroidManifest.xml --&gt;<br>&lt;manifest&gt;<br>    &lt;!-- ... --&gt;<br>    &lt;application&gt;<br>        &lt;!-- ... --&gt;<br>        &lt;service android:name=&quot;your.package.name.YourPushService&quot; android:exported=&quot;false&quot;&gt;<br>            &lt;intent-filter&gt;<br>                &lt;action android:name=&quot;com.google.firebase.MESSAGING_EVENT&quot; /&gt;<br>            &lt;/intent-filter&gt;<br>        &lt;/service&gt;<br>    &lt;/application&gt;<br>&lt;/manifest&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <p class="paragraph">The <code class="lang-kotlin">Application</code> code snippets above for handling push tokens and intents are still required.</p>
      <p class="paragraph">You may either subclass <code class="lang-kotlin">KlaviyoPushService</code> or invoke the necessary Klaviyo SDK methods in your service.</p>
      <ol>
        <li>
          <p class="paragraph">Subclass <code class="lang-kotlin">KlaviyoPushService</code>:</p>
          <div class="sample-container">
            <pre><code class="block lang-kotlin" theme="idea"> import com.google.firebase.messaging.RemoteMessage<br> import com.klaviyo.pushFcm.KlaviyoPushService<br> import com.klaviyo.pushFcm.KlaviyoRemoteMessage.isKlaviyoNotification<br><br> class YourPushService : KlaviyoPushService() {<br>     override fun onNewToken(newToken: String) {<br>         // Invoking the super method will ensure Klaviyo SDK gets the new token<br>         super.onNewToken(newToken)<br>     }<br><br>     override fun onMessageReceived(message: RemoteMessage) {<br>         // Invoking the super method allows Klaviyo SDK to handle Klaviyo messages<br>         super.onMessageReceived(message)<br>     <br>         // This extension method allows you to distinguish Klaviyo from other sources<br>         if (!message.isKlaviyoNotification) {<br>             // Handle non-Klaviyo messages<br>         }<br>     }<br> }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
        </li>
        <li>
          <p class="paragraph">Subclass <code class="lang-kotlin">FirebaseMessagingService</code> and invoke Klaviyo SDK methods directly</p>
          <div class="sample-container">
            <pre><code class="block lang-kotlin" theme="idea"> import com.google.firebase.messaging.FirebaseMessagingService<br> import com.google.firebase.messaging.RemoteMessage<br> import com.klaviyo.analytics.Klaviyo<br> import com.klaviyo.pushFcm.KlaviyoNotification<br> import com.klaviyo.pushFcm.KlaviyoRemoteMessage.isKlaviyoNotification<br><br> class YourPushService : FirebaseMessagingService() {<br><br>     override fun onNewToken(newToken: String) {<br>         super.onNewToken(newToken)<br>         Klaviyo.setPushToken(newToken)<br>     }<br><br>     override fun onMessageReceived(message: RemoteMessage) {<br>         super.onMessageReceived(message)<br><br>         // This extension method allows you to distinguish Klaviyo from other sources<br>         if (message.isKlaviyoNotification) {<br>             // Handle displaying a notification from Klaviyo<br>             KlaviyoNotification(message).displayNotification(this)<br>         } else {<br>             // Handle non-Klaviyo messages<br>         }<br>     }<br> }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
        </li>
      </ol>
      <p class="paragraph"><strong>Note:</strong> Klaviyo uses <a href="https://firebase.google.com/docs/cloud-messaging/android/receive">data messages</a> to provide consistent notification formatting. As a result, all Klaviyo notifications are handled via <code class="lang-kotlin">onMessageReceived</code> regardless of the app being in the background or foreground. If you are working with multiple remote sources, you can check whether a message originated from Klaviyo with the extension method <code class="lang-kotlin">RemoteMessage.isKlaviyoMessage</code>.</p>
      <h4 class=""> Custom Notification Display</h4>
      <p class="paragraph">If you wish to fully customize the display of notifications, we provide a set of <code class="lang-kotlin">RemoteMessage</code>  extensions such as <code class="lang-kotlin">import com.klaviyo.pushFcm.KlaviyoRemoteMessage.body</code> to access all the properties sent from Klaviyo. We also provide an <code class="lang-kotlin">Intent.appendKlaviyoExtras(RemoteMessage)</code> extension method, which attaches the data to your notification intent that the Klaviyo SDK requires in order to track opens when you call <code class="lang-kotlin">Klaviyo.handlePush(intent)</code>.</p>
      <h2 class=""> In App Forms</h2>
      <p class="paragraph"><a href="https://help.klaviyo.com/hc/en-us/articles/34567685177883">In-app forms</a> are messages displayed to mobile app  users while they are actively using your app. You can create new in-app forms in a drag-and-drop editor in the  Sign-Up Forms tab in Klaviyo. Follow the instructions in this section to integrate forms with your app. The SDK will display forms according to their targeting and behavior settings and collect delivery and engagement analytics automatically.</p>
      <h3 class=""> Prerequisites</h3>
      <ul>
        <li>
          <p class="paragraph">Version 3.2.0 or higher</p>
        </li>
        <li>
          <p class="paragraph">Klaviyo <code class="lang-kotlin">analytics</code> and <code class="lang-kotlin">forms</code> packages</p>
        </li>
        <li>
          <p class="paragraph">If you expect to use deep links in forms, see the #deep-linking section below.</p>
        </li>
      </ul>
      <h3 class=""> Setup</h3>
      <p class="paragraph">To display in-app forms add the following code to your application. </p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">import com.klaviyo.analytics.Klaviyo<br>import com.klaviyo.forms.registerForInAppForms<br><br>// You can register as soon as you've initialized<br>Klaviyo<br>    .initialize(&quot;KLAVIYO_PUBLIC_API_KEY&quot;, applicationContext)<br>    .registerForInAppForms()<br><br>// ... or any time thereafter<br>Klaviyo.registerForInAppForms()</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h3 class=""> Behavior</h3>
      <p class="paragraph">Once <code class="lang-kotlin">registerForInAppForms()</code> is called, the SDK will load form data for your account and display no more than one form  within 15 seconds, based on form targeting and behavior settings.</p>
      <p class="paragraph">You can call <code class="lang-kotlin">registerForInAppForms()</code> any time after initializing with your company ID to control when and where in  your app's UI a form can appear. It is safe to register multiple times per application session.  The SDK will internally prevent multiple forms appearing at once.</p>
      <p class="paragraph">Consider how often you want to register for forms. For example, registering from a lifecycle event is advisable  so that the user has multiple opportunities to see your messaging if they are browsing your app for a prolonged period. However, be advised the form will be shown as soon as it is ready, so you may still need to condition this based on the user's context within your application. Future versions of this product will provide more control in this regard.</p>
      <table>
        <thead>
          <tr>
            <th>Callback</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="org.jetbrains.dokka.pages.commenttable@10b47667 lang-kotlin">Application.onCreate()</code></td>
            <td>Show a form <i>only</i> upon initial app launch.</td>
          </tr>
          <tr>
            <td><code class="org.jetbrains.dokka.pages.commenttable@10b47667 lang-kotlin">Application.onResume()</code></td>
            <td>Anytime the app is foregrounded, check for forms and show if available.</td>
          </tr>
          <tr>
            <td><code class="org.jetbrains.dokka.pages.commenttable@10b47667 lang-kotlin">Activity.onCreate()</code></td>
            <td>If you only want forms to appear over a specific activity, checks every time this activity is created.</td>
          </tr>
        </tbody>
      </table>
      <p class="paragraph"><strong>Note:</strong> At this time, when device orientation changes any currently visible form is closed and will not be re-displayed automatically.</p>
      <h2 class=""> Deep Linking</h2>
      <p class="paragraph"><a href="https://help.klaviyo.com/hc/en-us/articles/14750403974043">Deep Links</a> allow you to navigate to a particular page within your app in response to a user interaction. Klaviyo supports deep linking from tapping on a Push Notification and from In-App Forms interactions. There are broadly three steps to implement deep links in your app:  </p>
      <ol>
        <li>
          <p class="paragraph">Add intent filters for incoming links:</p>
          <p class="paragraph"> Add an intent filter to the activity element of your <code class="lang-kotlin">AndroidManifest.xml</code> file.     Replace the scheme and host to match the URI scheme that you intend to use for notifications and forms. </p>
          <div class="sample-container">
            <pre><code class="block lang-xml" theme="idea"> &lt;!-- AndroidManifest.xml --&gt;<br> &lt;manifest&gt;<br>     &lt;!-- ... --&gt;<br>     &lt;application&gt;<br>         &lt;!-- ... --&gt;<br>         &lt;activity&gt;<br>             &lt;!-- ... --&gt;<br>             &lt;intent-filter android:label=&quot;@string/filter_view_example_gizmos&quot;&gt;<br>                 &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;<br>                 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;<br>                 &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;<br>                 &lt;!-- Accepts URIs formatted &quot;example://host.com” --&gt;<br>                 &lt;data android:scheme=&quot;example&quot; android:host=&quot;host.com&quot;/&gt;<br>             &lt;/intent-filter&gt;<br>         &lt;/activity&gt;<br>     &lt;/application&gt;<br> &lt;/manifest&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
        </li>
        <li>
          <p class="paragraph">Read data from incoming intents:</p>
          <p class="paragraph"> When a user taps a notification or a deep link in an in-app form, the Klaviyo SDK sends your app an intent containing that link.     You can parse the URI from the intent's data property and use it to navigate to the appropriate part of your app. </p>
          <div class="sample-container">
            <pre><code class="block lang-kotlin" theme="idea"> override fun onCreate(savedInstanceState: Bundle?) {<br>     /* ... */<br>     <br>     onNewIntent(intent)<br> }<br><br> override fun onNewIntent(intent: Intent?) {<br>     // Tracks when a system tray notification is opened<br>     Klaviyo.handlePush(intent)<br> <br>     // Read deep link data from intent<br>     val action: String? = intent?.action <br>     val deepLink: Uri? = intent?.data<br> }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
        </li>
        <li>
          <p class="paragraph">Test your deep links:</p>
          <p class="paragraph"> Using <a href="https://developer.android.com/studio/command-line/adb">android debug bridge (adb)</a>,     run the following command to launch your app via an intent containing a deep link to test your deep link handler.</p>
          <div class="sample-container">
            <pre><code class="block lang-shell" theme="idea"> adb shell am start<br>     -W -a android.intent.action.VIEW<br>     -d &lt;URI&gt; &lt;PACKAGE&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
              <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
            </span></div>
          <p class="paragraph"> To perform integration testing, you can send a     <a href="https://help.klaviyo.com/hc/en-us/articles/18011985278875">preview push notification</a>      containing a deep link from the Klaviyo push editor or use an in-app form that contains a &quot;Go to app screen&quot; action. </p>
        </li>
      </ol>
      <p class="paragraph">For additional resources on deep linking, refer to <a href="https://developer.android.com/training/app-links/deep-linking">Android developer documentation</a>.</p>
      <h2 class=""> Troubleshooting</h2>
      <p class="paragraph">The SDK contains logging at different levels from <code class="lang-kotlin">verbose</code> to <code class="lang-kotlin">assert</code>. By default, the SDK logs at the <code class="lang-kotlin">error</code> level in a production environment and at the <code class="lang-kotlin">warning</code> level in a debug environment. You can change the log level by adding  the following metadata tag to your manifest file. </p>
      <ul>
        <li>
          <p class="paragraph"><code class="lang-kotlin">0</code> = disable logging entirely</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">1</code> = <code class="lang-kotlin">Verbose</code> and above</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">2</code> = <code class="lang-kotlin">Debug</code> and above</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">3</code> = <code class="lang-kotlin">Info</code> and above</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">4</code> = <code class="lang-kotlin">Warning</code> and above</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">5</code> = <code class="lang-kotlin">Error</code> and above</p>
        </li>
        <li>
          <p class="paragraph"><code class="lang-kotlin">6</code> = <code class="lang-kotlin">Assert</code> only</p>
        </li>
      </ul>
      <div class="sample-container">
        <pre><code class="block lang-xml" theme="idea">&lt;!-- AndroidManifest.xml --&gt;    <br>&lt;manifest&gt;<br>    &lt;!-- ... --&gt;<br>    &lt;application&gt;<br>        &lt;!-- Enable SDK debug logging --&gt;<br>        &lt;meta-data<br>            android:name=&quot;com.klaviyo.core.log_level&quot;<br>            android:value=&quot;2&quot; /&gt;<br>    &lt;/application&gt;<br>&lt;/manifest&gt;</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h4 class=""> WebViews Compatibility</h4>
      <p class="paragraph">Klaviyo's in-app forms are powered by <a href="https://developer.android.com/reference/android/webkit/WebView">WebViews</a>. At this time, we require a version of WebView compatible with JavaScript standard ES2015. Older versions will fail gracefully without displaying a form to the user.</p>
      <p class="paragraph">WebView is a system app that updates independently of the OS (as of API level 21). Therefore, understanding backwards compatibility is more complicated than looking at Android version / API level. But in general, physical devices on  API level 23+ will be compatible. However, the WebView version installed emulators can be outdated, and so forms  may not work in an emulator running older versions of Android.</p>
      <h4 class=""> Proguard / R8 Issues</h4>
      <p class="paragraph">If you notice issues in the release build of your apps, you can try to manually add a couple rules to your <code class="lang-kotlin">proguard-rules.pro</code> to prevent obfuscation:</p>
      <div class="sample-container">
        <pre><code class="block lang-kotlin" theme="idea">-keep class com.klaviyo.analytics.** { *; }<br>-keep class com.klaviyo.core.** { *; }<br>-keep class com.klaviyo.push-fcm.** { *; }</code></pre>
<span class="top-right-position"><span class="copy-icon"></span>
          <div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div>
        </span></div>
      <h2 class=""> Contributing</h2>
      <p class="paragraph">See the .github/CONTRIBUTING.md to learn how to contribute to the Klaviyo Android SDK. We welcome your feedback in the <a href="https://github.com/klaviyo/klaviyo-android-sdk/issues">issues</a> section of our public GitHub repository.</p>
      <h2 class=""> License</h2>
      <p class="paragraph">The Klaviyo Android SDK is available under the MIT license. See ./LICENSE.md for more info.</p>
      <h2 class=""> Code Documentation</h2>
      <p class="paragraph">Browse complete code documentation autogenerated with Dokka <a href="https://klaviyo.github.io/klaviyo-android-sdk/">here</a>.</p>
    </div>
    <h2 class="">All modules:</h2>
    <div class="table"><a data-name="-242632249%2FMain%2F0" anchor-label="analytics" id="-242632249%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/analytics/index.html">analytics</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-242632249%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="-387464810%2FMain%2F0" anchor-label="core" id="-387464810%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/core/index.html">core</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-387464810%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="1811326475%2FMain%2F0" anchor-label="fixtures" id="1811326475%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/fixtures/index.html">fixtures</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1811326475%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="-70699202%2FMain%2F0" anchor-label="forms" id="-70699202%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/forms/index.html">forms</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-70699202%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
<a data-name="-503032104%2FMain%2F0" anchor-label="push-fcm" id="-503032104%2FMain%2F0" data-filterable-set=""></a>
      <div class="table-row">
        <div class="main-subrow ">
          <div class="w-100"><span class="inline-flex">
              <div><a href="sdk/push-fcm/index.html">push-fcm</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-503032104%2FMain%2F0"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div><span class="brief-comment"></span></div>
        </div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2025 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
            </div>
        </div>
    </div>
</body>
</html>
